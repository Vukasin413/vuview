{"version":3,"file":"vidstack-video-DJmD_cO0.js","sources":["../../../../../node_modules/.pnpm/vidstack@1.11.13/node_modules/vidstack/prod/providers/vidstack-video.js"],"sourcesContent":["import { q as onDispose, l as listenEvent, D as DOMEvent, e as scoped } from '../chunks/vidstack-CSyVEdLV.js';\nimport { h as canUsePictureInPicture, j as canUseVideoPresentation, g as canPlayHLSNatively } from '../chunks/vidstack-BupzoABp.js';\nimport { HTMLMediaProvider } from './vidstack-html.js';\nimport { H as HTMLAirPlayAdapter } from '../chunks/vidstack-BJhWhebu.js';\nimport { T as TextTrack, a as TextTrackSymbol } from '../chunks/vidstack-CqXkSIjG.js';\nimport '../chunks/vidstack-CpkvFYuN.js';\nimport '../chunks/vidstack-ksPACRiU.js';\nimport '../chunks/vidstack-CerDQCFL.js';\nimport '../chunks/vidstack-BhcIzQoA.js';\n\nclass NativeHLSTextTracks {\n  constructor(_video, _ctx) {\n    this.m = _video;\n    this.b = _ctx;\n    _video.textTracks.onaddtrack = this.Wc.bind(this);\n    onDispose(this.cd.bind(this));\n  }\n  Wc(event) {\n    const nativeTrack = event.track;\n    if (!nativeTrack || findTextTrackElement(this.m, nativeTrack))\n      return;\n    const track = new TextTrack({\n      id: nativeTrack.id,\n      kind: nativeTrack.kind,\n      label: nativeTrack.label ?? \"\",\n      language: nativeTrack.language,\n      type: \"vtt\"\n    });\n    track[TextTrackSymbol.T] = { track: nativeTrack };\n    track[TextTrackSymbol.M] = 2;\n    track[TextTrackSymbol.te] = true;\n    let lastIndex = 0;\n    const onCueChange = (event2) => {\n      if (!nativeTrack.cues)\n        return;\n      for (let i = lastIndex; i < nativeTrack.cues.length; i++) {\n        track.addCue(nativeTrack.cues[i], event2);\n        lastIndex++;\n      }\n    };\n    onCueChange(event);\n    nativeTrack.oncuechange = onCueChange;\n    this.b.textTracks.add(track, event);\n    track.setMode(nativeTrack.mode, event);\n  }\n  cd() {\n    this.m.textTracks.onaddtrack = null;\n    for (const track of this.b.textTracks) {\n      const nativeTrack = track[TextTrackSymbol.T]?.track;\n      if (nativeTrack?.oncuechange)\n        nativeTrack.oncuechange = null;\n    }\n  }\n}\nfunction findTextTrackElement(video, track) {\n  return Array.from(video.children).find((el) => el.track === track);\n}\n\nclass VideoPictureInPicture {\n  constructor(_video, _media) {\n    this.m = _video;\n    this.a = _media;\n    this.B = (active, event) => {\n      this.a.delegate.c(\"picture-in-picture-change\", active, event);\n    };\n    listenEvent(this.m, \"enterpictureinpicture\", this.Jg.bind(this));\n    listenEvent(this.m, \"leavepictureinpicture\", this.Kg.bind(this));\n  }\n  get active() {\n    return document.pictureInPictureElement === this.m;\n  }\n  get supported() {\n    return canUsePictureInPicture(this.m);\n  }\n  async enter() {\n    return this.m.requestPictureInPicture();\n  }\n  exit() {\n    return document.exitPictureInPicture();\n  }\n  Jg(event) {\n    this.B(true, event);\n  }\n  Kg(event) {\n    this.B(false, event);\n  }\n}\n\nclass VideoPresentation {\n  constructor(_video, _media) {\n    this.m = _video;\n    this.a = _media;\n    this.I = \"inline\";\n    listenEvent(this.m, \"webkitpresentationmodechanged\", this.Ua.bind(this));\n  }\n  get Se() {\n    return canUseVideoPresentation(this.m);\n  }\n  async kc(mode) {\n    if (this.I === mode)\n      return;\n    this.m.webkitSetPresentationMode(mode);\n  }\n  Ua(event) {\n    const prevMode = this.I;\n    this.I = this.m.webkitPresentationMode;\n    this.a.player?.dispatch(\n      new DOMEvent(\"video-presentation-change\", {\n        detail: this.I,\n        trigger: event\n      })\n    );\n    [\"fullscreen\", \"picture-in-picture\"].forEach((type) => {\n      if (this.I === type || prevMode === type) {\n        this.a.delegate.c(`${type}-change`, this.I === type, event);\n      }\n    });\n  }\n}\nclass FullscreenPresentationAdapter {\n  constructor(_presentation) {\n    this.fa = _presentation;\n  }\n  get active() {\n    return this.fa.I === \"fullscreen\";\n  }\n  get supported() {\n    return this.fa.Se;\n  }\n  async enter() {\n    this.fa.kc(\"fullscreen\");\n  }\n  async exit() {\n    this.fa.kc(\"inline\");\n  }\n}\nclass PIPPresentationAdapter {\n  constructor(_presentation) {\n    this.fa = _presentation;\n  }\n  get active() {\n    return this.fa.I === \"picture-in-picture\";\n  }\n  get supported() {\n    return this.fa.Se;\n  }\n  async enter() {\n    this.fa.kc(\"picture-in-picture\");\n  }\n  async exit() {\n    this.fa.kc(\"inline\");\n  }\n}\n\nclass VideoProvider extends HTMLMediaProvider {\n  constructor(video, ctx) {\n    super(video, ctx);\n    this.$$PROVIDER_TYPE = \"VIDEO\";\n    scoped(() => {\n      this.airPlay = new HTMLAirPlayAdapter(video, ctx);\n      if (canUseVideoPresentation(video)) {\n        const presentation = new VideoPresentation(video, ctx);\n        this.fullscreen = new FullscreenPresentationAdapter(presentation);\n        this.pictureInPicture = new PIPPresentationAdapter(presentation);\n      } else if (canUsePictureInPicture(video)) {\n        this.pictureInPicture = new VideoPictureInPicture(video, ctx);\n      }\n    }, this.scope);\n  }\n  get type() {\n    return \"video\";\n  }\n  setup() {\n    super.setup();\n    if (canPlayHLSNatively(this.video)) {\n      new NativeHLSTextTracks(this.video, this.b);\n    }\n    this.b.textRenderers.Fe(this.video);\n    onDispose(() => {\n      this.b.textRenderers.Fe(null);\n    });\n    if (this.type === \"video\")\n      this.b.delegate.c(\"provider-setup\", this);\n  }\n  /**\n   * The native HTML `<video>` element.\n   *\n   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLVideoElement}\n   */\n  get video() {\n    return this.a;\n  }\n}\n\nexport { VideoProvider };\n"],"names":["NativeHLSTextTracks","constructor","_video","_ctx","m","b","textTracks","onaddtrack","Wc","bind","onDispose","cd","event","nativeTrack","track","findTextTrackElement","TextTrack","id","kind","label","language","type","TextTrackSymbol","T","M","te","lastIndex","onCueChange","event2","cues","i","length","addCue","oncuechange","add","setMode","mode","video","Array","from","children","find","el","VideoPictureInPicture","_media","a","B","active","delegate","c","listenEvent","Jg","Kg","document","pictureInPictureElement","supported","canUsePictureInPicture","enter","requestPictureInPicture","exit","exitPictureInPicture","VideoPresentation","I","Ua","Se","canUseVideoPresentation","kc","webkitSetPresentationMode","prevMode","webkitPresentationMode","player","dispatch","DOMEvent","detail","trigger","forEach","FullscreenPresentationAdapter","_presentation","fa","PIPPresentationAdapter","VideoProvider","HTMLMediaProvider","ctx","$$PROVIDER_TYPE","scoped","airPlay","HTMLAirPlayAdapter","presentation","fullscreen","pictureInPicture","scope","setup","canPlayHLSNatively","textRenderers","Fe"],"mappings":"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","x_google_ignoreList":[0]}