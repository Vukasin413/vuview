import{createComponent as e,ssr as o,ssrHydrationKey as s,escape as c}from"solid-js/web";import{createSignal as p,createEffect as l,Suspense as g,Show as i,For as y}from"solid-js";import{A as b,E as w,_ as S,$ as v,a0 as x,a1 as C,a2 as O,L as j,C as k,V as T}from"./Toast.mjs";import{createQuery as A}from"@tanstack/solid-query";import{E}from"./Error.mjs";import{u as R}from"./useIntersectionObserver.mjs";import{E as _}from"./EmptyState.mjs";import{u as F}from"./Link.mjs";import{a as $}from"./index5.mjs";import{T as I}from"./index3.mjs";import"y-webrtc";import"yjs";import"solid-js/store";import"lib0/observable";import"numeral";import"@solid-primitives/date";import"./index4.mjs";import"./index2.mjs";import"./routing.mjs";import"./components.mjs";var P=["<p",">Refresh (Shift + R)</p>"],q=["<div",' class="h-[80vh] w-full flex items-center justify-center">',"</div>"],H=["<div",' class="mx-2 flex flex-wrap gap-2 justify-center"><!--$-->',"<!--/--><!--$-->","<!--/--></div>"],K=["<div",' class="h-20 "></div>'];function ce(){const[u,m]=p(10),[a]=b(),r=w(),t=A(()=>({queryKey:["feed",a.instance.api_url,r.store.subscriptions],queryFn:async()=>{const n=await fetch(a.instance.api_url+"/feed/unauthenticated",{method:"POST",body:JSON.stringify(Object.keys(r.store.subscriptions))});if(!n.ok)throw new Error("Error fetching feed");return n.json()},enabled:!!(a.instance?.api_url&&Object.keys(r.store.subscriptions).length>0),placeholderData:Array(50).fill(void 0),refetchOnMount:!0,refetchOnReconnect:!0})),[d,L]=p(),f=R({setTarget:()=>d()});l(()=>{f()&&m(n=>n+10)});const[V,h]=F();return l(()=>{console.log(r.store.subscriptions,Object.keys(r.store.subscriptions),"feed"),h({loading:t.isRefetching||t.isFetching})}),l(()=>{console.log(t.data,"feed")}),e(g,{get fallback(){return e(S,{})},get children(){return[e(v,{get children(){return[e(x,{class:"fixed bottom-20 sm:bottom-10 right-10 rounded-full w-10 h-10 bg-primary z-50 flex items-center justify-center",onClick:()=>{t.isFetching||t.refetch()},get children(){return e($,{fill:"currentColor",class:"w-6 h-6"})}}),e(C,{get children(){return e(O,{class:"p-2 bg-bg2 rounded max-w-[min(calc(100vw-16px),380px)] animate-[contentHide] data-[expanded]:animate-[contentShow]",get children(){return[e(j,{}),o(P,s())]}})}})]}}),e(I,{children:"Feed | Conduit"}),e(i,{get when(){return!Object.keys(r.store.subscriptions).length},get children(){return o(q,s(),c(e(_,{message:"You have no subscriptions.",get children(){return e(k,{as:"a",label:"Import",href:"/import"})}})))}}),e(i,{get when(){return Object.keys(r.store.subscriptions).length},get children(){return o(H,s(),c(e(i,{get when(){return!Array.isArray(t.data)},get children(){return e(E,{get error(){return t.data}})}})),c(e(i,{get when(){return t.data&&t.data.length>0},get children(){return e(y,{get each(){return t.data?.filter(n=>!r.store.blocklist[n?.uploaderUrl?.split("/").pop()]).slice(0,u())},children:n=>e(T,{v:n})})}})))}}),o(K,s())]}})}export{ce as default};
//# sourceMappingURL=feed.mjs.map
