import{createComponent as t,mergeProps as _,ssr as f,ssrHydrationKey as p,ssrAttribute as j,escape as d}from"solid-js/web";import{createMemo as J,splitProps as k,mergeProps as ne,createContext as re,useContext as ae,createSignal as w,createEffect as P,on as N,onCleanup as ie,Show as v,onMount as se,createUniqueId as oe,Suspense as S,For as M,Switch as L,Match as C}from"solid-js";import{c as le,aa as G,ar as ce,l as ue,P as q,as as de,at as X,au as ge,av as D,m as Y,aw as he,ax as fe,ay as pe,az as be,i as me,A as E,_ as m,V as B,ad as H}from"./Toast.mjs";import{C as Z,S as ve}from"./Description.mjs";import{u as O}from"./useIntersectionObserver.mjs";import{u as ye}from"./Link.mjs";import{createInfiniteQuery as A}from"@tanstack/solid-query";import{E as U}from"./EmptyState.mjs";import{TransitionGroup as xe}from"solid-transition-group";import{P as we}from"./PlaylistCard.mjs";import{h as Pe}from"./routing.mjs";import{A as Q}from"./components.mjs";import"./index5.mjs";import"./index2.mjs";import"y-webrtc";import"yjs";import"solid-js/store";import"lib0/observable";import"numeral";import"@solid-primitives/date";import"./index4.mjs";/*!
 * Portions of this file are based on code from react-spectrum.
 * Apache License Version 2.0, Copyright 2020 Adobe.
 *
 * Credits to the React Spectrum team:
 * https://github.com/adobe/react-spectrum/blob/8f2f2acb3d5850382ebe631f055f88c704aa7d17/packages/@react-stately/list/src/useSingleSelectListState.ts
 */function Ie(a){const[n,e]=le({value:()=>G(a.selectedKey),defaultValue:()=>G(a.defaultSelectedKey),onChange:o=>a.onSelectionChange?.(o)}),r=J(()=>{const o=n();return o!=null?[o]:[]}),[,u]=k(a,["onSelectionChange"]),h=ne(u,{selectionMode:"single",disallowEmptySelection:!0,allowDuplicateSelectionEvents:!0,selectedKeys:r,onSelectionChange:o=>{const b=o.values().next().value;b===n()&&a.onSelectionChange?.(b),e(b)}}),{collection:i,selectionManager:s}=ce(h),g=J(()=>{const o=n();return o!=null?i().getItem(o):void 0});return{collection:i,selectionManager:s,selectedKey:n,setSelectedKey:e,selectedItem:g}}const ee=re();function z(){const a=ae(ee);if(a===void 0)throw new Error("[kobalte]: `useTabsContext` must be used within a `Tabs` component");return a}function F(a){let n;const e=z(),[r,u]=k(a,["ref","id","value","forceMount"]),[h,i]=w(0),s=()=>r.id??e.generateContentId(r.value),g=()=>e.listState().selectedKey()===r.value,o=ue(()=>r.forceMount||g());return P(N([()=>n,()=>o.isPresent()],([b,x])=>{if(b==null||!x)return;const $=()=>{const y=de(b,{tabbable:!0});i(y.nextNode()?void 0:0)};$();const T=new MutationObserver($);T.observe(b,{subtree:!0,childList:!0,attributes:!0,attributeFilter:["tabindex","disabled"]}),ie(()=>{T.disconnect()})})),P(N([()=>r.value,s],([b,x])=>{e.contentIdsMap().set(b,x)})),t(v,{get when(){return o.isPresent()},get children(){return t(q,_({as:"div",get id(){return s()},role:"tabpanel",get tabIndex(){return h()},get"aria-labelledby"(){return e.triggerIdsMap().get(r.value)},get"data-orientation"(){return e.orientation()},get"data-selected"(){return g()?"":void 0}},u))}})}function Ke(a){const n=z(),[e,r]=k(a,["style"]),[u,h]=w({width:void 0,height:void 0}),{direction:i}=X(),s=()=>{const g=n.selectedTab();if(g==null)return;const o={transform:void 0,width:void 0,height:void 0},b=i()==="rtl"?-1*(g.offsetParent?.offsetWidth-g.offsetWidth-g.offsetLeft):g.offsetLeft;o.transform=n.orientation()==="vertical"?`translateY(${g.offsetTop}px)`:`translateX(${b}px)`,n.orientation()==="horizontal"?o.width=`${g.offsetWidth}px`:o.height=`${g.offsetHeight}px`,h(o)};return se(()=>{queueMicrotask(()=>{s()})}),P(N([n.selectedTab,n.orientation,i],()=>{s()},{defer:!0})),t(q,_({as:"div",role:"presentation",get style(){return{...u(),...e.style}},get"data-orientation"(){return n.orientation()}},r))}/*!
 * Portions of this file are based on code from react-spectrum.
 * Apache License Version 2.0, Copyright 2020 Adobe.
 *
 * Credits to the React Spectrum team:
 * https://github.com/adobe/react-spectrum/blob/6b51339cca0b8344507d3c8e81e7ad05d6e75f9b/packages/@react-aria/tabs/src/TabsKeyboardDelegate.ts
 */class Se{collection;direction;orientation;constructor(n,e,r){this.collection=n,this.direction=e,this.orientation=r}flipDirection(){return this.direction()==="rtl"&&this.orientation()==="horizontal"}getKeyLeftOf(n){return this.flipDirection()?this.getNextKey(n):this.orientation()==="horizontal"?this.getPreviousKey(n):void 0}getKeyRightOf(n){return this.flipDirection()?this.getPreviousKey(n):this.orientation()==="horizontal"?this.getNextKey(n):void 0}getKeyAbove(n){if(this.orientation()==="vertical")return this.getPreviousKey(n)}getKeyBelow(n){if(this.orientation()==="vertical")return this.getNextKey(n)}getFirstKey(){let n=this.collection().getFirstKey();return n==null?void 0:(this.collection().getItem(n)?.disabled&&(n=this.getNextKey(n)),n)}getLastKey(){let n=this.collection().getLastKey();return n==null?void 0:(this.collection().getItem(n)?.disabled&&(n=this.getPreviousKey(n)),n)}getNextKey(n){let e=n,r;do if(e=this.collection().getKeyAfter(e)??this.collection().getFirstKey(),e==null||(r=this.collection().getItem(e),r==null))return;while(r.disabled);return e}getPreviousKey(n){let e=n,r;do if(e=this.collection().getKeyBefore(e)??this.collection().getLastKey(),e==null||(r=this.collection().getItem(e),r==null))return;while(r.disabled);return e}}function De(a){let n;const e=z(),[r,u]=k(a,["ref","onKeyDown","onMouseDown","onFocusIn","onFocusOut"]),{direction:h}=X(),i=new Se(()=>e.listState().collection(),h,e.orientation),s=ge({selectionManager:()=>e.listState().selectionManager(),keyboardDelegate:()=>i,selectOnFocus:()=>e.activationMode()==="automatic",shouldFocusWrap:!1,disallowEmptySelection:!0},()=>n);return P(()=>{}),t(q,_({as:"div",role:"tablist",get"aria-orientation"(){return e.orientation()},get"data-orientation"(){return e.orientation()},get onKeyDown(){return D([r.onKeyDown,s.onKeyDown])},get onMouseDown(){return D([r.onMouseDown,s.onMouseDown])},get onFocusIn(){return D([r.onFocusIn,s.onFocusIn])},get onFocusOut(){return D([r.onFocusOut,s.onFocusOut])}},u))}function Ce(a){const n=`tabs-${oe()}`;a=Y({id:n,orientation:"horizontal",activationMode:"automatic"},a);const[e,r]=k(a,["value","defaultValue","onChange","orientation","activationMode","disabled"]),[u,h]=w([]),[i,s]=w(),{DomCollectionProvider:g}=he({items:u,onItemsChange:h}),o=Ie({selectedKey:()=>e.value,defaultSelectedKey:()=>e.defaultValue,onSelectionChange:y=>e.onChange?.(String(y)),dataSource:u});let b=o.selectedKey();P(N([()=>o.selectionManager(),()=>o.collection(),()=>o.selectedKey()],([y,I,l])=>{let c=l;if(y.isEmpty()||c==null||!I.getItem(c)){c=I.getFirstKey();let K=c!=null?I.getItem(c):void 0;for(;K?.disabled&&K.key!==I.getLastKey();)c=I.getKeyAfter(K.key),K=c!=null?I.getItem(c):void 0;K?.disabled&&c===I.getLastKey()&&(c=I.getFirstKey()),c!=null&&y.setSelectedKeys([c])}(y.focusedKey()==null||!y.isFocused()&&c!==b)&&y.setFocusedKey(c),b=c}));const x=new Map,$=new Map,T={isDisabled:()=>e.disabled??!1,orientation:()=>e.orientation,activationMode:()=>e.activationMode,triggerIdsMap:()=>x,contentIdsMap:()=>$,listState:()=>o,selectedTab:i,setSelectedTab:s,generateTriggerId:y=>`${r.id}-trigger-${y}`,generateContentId:y=>`${r.id}-content-${y}`};return t(g,{get children(){return t(ee.Provider,{value:T,get children(){return t(q,_({as:"div",get"data-orientation"(){return T.orientation()}},r))}})}})}function Te(a){let n;const e=z();a=Y({type:"button"},a);const[r,u]=k(a,["ref","id","value","disabled","onPointerDown","onPointerUp","onClick","onKeyDown","onMouseDown","onFocus"]),h=()=>r.id??e.generateTriggerId(r.value),i=()=>e.listState().selectionManager().focusedKey()===r.value,s=()=>r.disabled||e.isDisabled(),g=()=>e.contentIdsMap().get(r.value);fe({getItem:()=>({ref:()=>n,type:"item",key:r.value,textValue:"",disabled:s()})});const o=pe({key:()=>r.value,selectionManager:()=>e.listState().selectionManager(),disabled:s},()=>n),b=x=>{be()&&me(x.currentTarget)};return P(N([()=>r.value,h],([x,$])=>{e.triggerIdsMap().set(x,$)})),t(q,_({as:"button",get id(){return h()},role:"tab",get tabIndex(){return s()?void 0:o.tabIndex()},get disabled(){return s()},get"aria-selected"(){return o.isSelected()},get"aria-disabled"(){return s()||void 0},get"aria-controls"(){return o.isSelected()?g():void 0},get"data-key"(){return o.dataKey()},get"data-orientation"(){return e.orientation()},get"data-selected"(){return o.isSelected()?"":void 0},get"data-highlighted"(){return i()?"":void 0},get"data-disabled"(){return s()?"":void 0},get onPointerDown(){return D([r.onPointerDown,o.onPointerDown])},get onPointerUp(){return D([r.onPointerUp,o.onPointerUp])},get onClick(){return D([r.onClick,o.onClick,b])},get onKeyDown(){return D([r.onKeyDown,o.onKeyDown])},get onMouseDown(){return D([r.onMouseDown,o.onMouseDown])},get onFocus(){return D([r.onFocus,o.onFocus])}},u))}var $e=["<img",' class="w-full pb-1.5" loading="lazy">'],Me=["<div",' class="ml-auto">',"</div>"],ke=["<div",' class="flex items-center"><img height="48" width="48" class="rounded-full m-1"','><h1 class="text-xl font-bold mr-2">',"</h1><!--$-->","<!--/--><!--$-->","<!--/--></div>"],Fe=["<div",' class="flex flex-wrap justify-center"><!--$-->',"<!--/--><!--$-->",'<!--/--><div class="w-full h-20 mt-2"></div></div>'],Ne=["<div",' class="relative">',"</div>"],_e=["<span",' class=""><!--$-->','<!--/-->...<br><button class="underline">Read more</button></span>'],Le=["<span",' class=""><!--$-->','<!--/--><br><button class="underline">Read less</button></span>'],W=["<div",' class="flex flex-wrap justify-center"><!--$-->',"<!--/--><!--$-->","<!--/--></div>"],V=["<div",' class="w-full h-20 mt-2"></div>'],qe=["<div",' class="relative w-20 overflow-hidden rounded-full group-hover:ring-2 group-focus-visible:ring-2 ring-accent1 transition-shadow duration-300"><img class="w-full rounded-full transition-transform duration-300 group-hover:scale-105 group-focus-visible:scale-105"',' loading="lazy"></div>'],Ee=["<div",' class="flex gap-1"><span>',"</span><!--$-->","<!--/--></div>"],Oe=["<div",' class="w-44 mx-1 flex flex-col gap-2 items-start"><!--$-->',"<!--/--><!--$-->","<!--/--></div>"];async function R(a,n,{pageParam:e}){return e?await H(`${a}/channels/tabs`,{data:n,nextpage:e??null}):await H(`${a}/channels/tabs`,{data:n})}function dt(){const[a,n]=w([]),[e]=E(),r=Pe(),[u,h]=w(r.query.tab??"videos");ye();async function i({pageParam:l}){if(l)return await H(`${e.instance.api_url}/nextpage/channel/${s.data?.pages[0].id}`,{nextpage:l});{const c=`${e.instance.api_url}${r.pathname}/`;return fetch(c).then(K=>K.json())}}const s=A(()=>({queryKey:["channelData",r.pathname,e.instance.api_url],queryFn:i,getNextPageParam:l=>l.nextpage,enabled:!!(r?.pathname&&e?.instance?.api_url),initialPageParam:null,deferStream:!0,initialData:()=>{}}));P(()=>{if(!s.data)return;const l=s.data.pages[0];if(!l)return;document.title=`${l.name} - Conduit`;const c=l.tabs;c&&(console.log("tabs",c),n([{name:"videos",data:null},...c]))});const g=O({setTarget:()=>o(),threshold:.1}),[o,b]=w(void 0);P(()=>{if(g()){if(console.log("intersecting"),s.isFetchingNextPage||!s.hasNextPage)return;s.fetchNextPage(),console.log(s.data)}});const[x,$]=w(a().findIndex(l=>l.name===u())??0),[T,y]=w(!1);function I(l){console.log("loadTab",l);let c=x();$(a().findIndex(te=>te.name===l)??x()),y(c>x()),console.log("navigating ",T()?"left":"right",c,x()),h(l);const K=new URL(window.location.href);K.searchParams.set("tab",l??"videos"),history.replaceState(window.history.state,"",K)}return t(S,{get fallback(){return t(m,{})},get children(){return t(v,{get when(){return s.data},get fallback(){return t(m,{})},get children(){return[t(v,{get when(){return s.data?.pages?.[0]?.bannerUrl},get children(){return f($e,p()+j("src",d(s.data?.pages[0].bannerUrl,!0),!1))}}),f(ke,p(),j("src",d(s.data?.pages?.[0]?.avatarUrl,!0),!1),d(s.data?.pages?.[0]?.name),d(t(v,{get when(){return s.data?.pages?.[0]?.verified},get children(){return t(Z,{})}})),d(t(v,{get when(){return s.data?.pages?.[0]?.id},get children(){return f(Me,p(),d(t(ve,{get name(){return s.data?.pages[0].name},get id(){return s.data?.pages[0].id}})))}}))),t(Ae,{get description(){return s.data?.pages?.[0]?.description??""}}),t(Ce,{class:"w-full min-h-screen",get value(){return u()},onChange:l=>I(l),activationMode:"manual",get children(){return[t(De,{class:"relative flex items-center border-b overflow-x-auto scrollbar [&::-webkit-scrollbar]:!h-1",get children(){return[t(M,{each:["videos","shorts","livestreams","playlists","channels"],children:l=>t(Te,{class:"inline-block pl-1 pt-2 pr-4 outline-none hover:bg-primary/20 focus-visible:bg-primary/20 first-letter:uppercase",value:l,children:l})}),t(Ke,{class:"absolute -bottom-px w-full h-[2px] bg-primary transition-all duration-250"})]}}),t(xe,{appear:!0,enterActiveClass:"transition-all ease-in-out duration-250 transform",get enterClass(){return T()?"-translate-x-full":"translate-x-full"},enterToClass:"translate-x-0",exitActiveClass:"transition-all ease-in-out duration-250 transform",exitClass:"translate-x-0",get exitToClass(){return T()?"translate-x-full":"-translate-x-full"},get children(){return[t(F,{value:"videos",get children(){return f(Fe,p(),d(t(v,{get when(){return s.error},get children(){return JSON.stringify(s.error)}})),d(t(S,{get fallback(){return t(m,{})},get children(){return t(v,{get when(){return s.data},get children(){return t(L,{get fallback(){return t(m,{})},get children(){return[t(C,{get when(){return s.data.pages&&s.data.pages.length>0&&!s.data.pages[0].relatedStreams?.length},get children(){return t(U,{})}}),t(C,{get when(){return s.isSuccess&&s.data.pages.length>0&&s.data.pages[0].relatedStreams?.length},get children(){return t(M,{get each(){return s.data?.pages?.map(l=>l.relatedStreams??[]).flat()},children:l=>t(B,{v:l})})}})]}})}})}})))}}),t(F,{value:"shorts",get children(){return t(S,{get fallback(){return t(m,{})},get children(){return t(Ue,{get tabData(){return a().find(l=>l.name=="shorts")?.data}})}})}}),t(F,{value:"playlists",get children(){return t(S,{get fallback(){return t(m,{})},get children(){return t(We,{get tabData(){return a().find(l=>l.name=="playlists")?.data}})}})}}),t(F,{value:"livestreams",get children(){return t(S,{get fallback(){return t(m,{})},get children(){return t(ze,{get tabData(){return a().find(l=>l.name=="livestreams")?.data}})}})}}),t(F,{value:"channels",get children(){return t(S,{get fallback(){return t(m,{})},get children(){return t(Ve,{get tabData(){return a().find(l=>l.name=="channels")?.data}})}})}})]}})]}})]}})}})}const Ae=a=>{const[n,e]=w(!0);return f(Ne,p(),n()?f(_e,p(),d(a.description.slice(0,200))):f(Le,p(),d(a.description)))},Ue=a=>{const[n]=E(),e=A(()=>({queryKey:["shortsTab",a.tabData,n.instance.api_url],queryFn:i=>R(n.instance.api_url,a.tabData,i),getNextPageParam:i=>i.nextpage,enabled:!!(a.tabData&&n?.instance?.api_url),initialPageParam:void 0})),r=O({setTarget:()=>u(),threshold:.1}),[u,h]=w(void 0);return P(()=>{if(r()){if(console.log("intersecting"),e.isFetchingNextPage||!e.hasNextPage)return;e.fetchNextPage(),console.log(e.data)}}),t(S,{get fallback(){return t(m,{})},get children(){return[f(W,p(),d(t(v,{get when(){return e.data},get children(){return t(L,{get fallback(){return t(m,{})},get children(){return[t(C,{get when(){return e.data.pages&&e.data.pages.length>0&&!e.data.pages[0].content?.length},get children(){return t(U,{})}}),t(C,{get when(){return e.isSuccess&&e.data.pages.length>0&&e.data.pages[0].content?.length},get children(){return t(M,{get each(){return e.data?.pages?.map(i=>i.content??[]).flat()},children:i=>t(B,{v:i})})}})]}})}})),d(t(v,{get when(){return e.error},get children(){return t(ErrorMessage,{get error(){return e.error}})}}))),f(V,p())]}})},ze=a=>{const[n]=E(),e=A(()=>({queryKey:["livestreamsTab",a.tabData,n.instance.api_url],queryFn:i=>R(n.instance.api_url,a.tabData,i),getNextPageParam:i=>i.nextpage,enabled:!!(a.tabData&&n?.instance?.api_url),initialPageParam:void 0})),r=O({setTarget:()=>u(),threshold:.1}),[u,h]=w(void 0);return P(()=>{if(r()){if(console.log("intersecting"),e.isFetchingNextPage||!e.hasNextPage)return;e.fetchNextPage(),console.log(e.data)}}),t(S,{get fallback(){return t(m,{})},get children(){return[f(W,p(),d(t(v,{get when(){return e.data},get children(){return t(L,{get fallback(){return t(m,{})},get children(){return[t(C,{get when(){return e.data.pages&&e.data.pages.length>0&&!e.data.pages[0].content?.length},get children(){return t(U,{})}}),t(C,{get when(){return e.isSuccess&&e.data.pages.length>0&&e.data.pages[0].content?.length},get children(){return t(M,{get each(){return e.data?.pages?.map(i=>i.content??[]).flat()},children:i=>t(B,{v:i})})}})]}})}})),d(t(v,{get when(){return e.error},get children(){return t(ErrorMessage,{get error(){return e.error}})}}))),f(V,p())]}})},We=a=>{const[n]=E(),e=A(()=>({queryKey:["playlistsTab",a.tabData,n.instance.api_url],queryFn:i=>R(n.instance.api_url,a.tabData,i),getNextPageParam:i=>i.nextpage,enabled:!!(a.tabData&&n?.instance?.api_url),initialPageParam:void 0})),r=O({setTarget:()=>u(),threshold:.1}),[u,h]=w(void 0);return P(()=>{if(r()){if(console.log("intersecting"),e.isFetchingNextPage||!e.hasNextPage)return;e.fetchNextPage(),console.log(e.data)}}),t(S,{get fallback(){return t(m,{})},get children(){return[f(W,p(),d(t(v,{get when(){return e.data},get children(){return t(L,{get fallback(){return t(m,{})},get children(){return[t(C,{get when(){return e.data.pages&&e.data.pages.length>0&&!e.data.pages[0].content?.length},get children(){return t(U,{})}}),t(C,{get when(){return e.isSuccess&&e.data.pages.length>0&&e.data.pages[0].content?.length},get children(){return t(M,{get each(){return e.data?.pages?.map(i=>i.content??[]).flat()},children:i=>t(we,{item:i})})}})]}})}})),d(t(v,{get when(){return e.error},get children(){return t(ErrorMessage,{get error(){return e.error}})}}))),f(V,p())]}})},Ve=a=>{const[n]=E(),e=A(()=>({queryKey:["channelsTab",a.tabData,n.instance.api_url],queryFn:i=>R(n.instance.api_url,a.tabData,i),getNextPageParam:i=>i.nextpage,enabled:!!(a.tabData&&n?.instance?.api_url),initialPageParam:void 0})),r=O({setTarget:()=>u(),threshold:.1}),[u,h]=w(void 0);return P(()=>{if(r()){if(console.log("intersecting"),e.isFetchingNextPage||!e.hasNextPage)return;e.fetchNextPage(),console.log(e.data)}}),t(S,{get fallback(){return t(m,{})},get children(){return[f(W,p(),d(t(v,{get when(){return e.data},get children(){return t(L,{get fallback(){return t(m,{})},get children(){return[t(C,{get when(){return e.data.pages&&e.data.pages.length>0&&!e.data.pages[0].content?.length},get children(){return t(U,{})}}),t(C,{get when(){return e.isSuccess&&e.data.pages.length>0&&e.data.pages[0].content?.length},get children(){return t(M,{get each(){return e.data?.pages.map(i=>i.content).flat()},children:i=>f(Oe,p(),d(t(Q,{get href(){return i.url},class:"group outline-none",get children(){return f(qe,p(),j("src",d(i.thumbnail,!0),!1))}})),d(t(Q,{class:"link",get href(){return i.url},get children(){return f(Ee,p(),d(i.name),d(t(v,{get when(){return i.verified},get children(){return t(Z,{})}})))}})))})}})]}})}})),d(t(v,{get when(){return e.error},get children(){return t(ErrorMessage,{get error(){return e.error}})}}))),f(V,p())]}})};export{dt as default};
//# sourceMappingURL=_id_.mjs.map
