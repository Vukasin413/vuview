import{createComponent as t,mergeProps as T,ssrElement as ee,ssr as f,ssrHydrationKey as m,escape as i,ssrAttribute as B,isServer as z}from"solid-js/web";import{createContext as te,useContext as re,createUniqueId as ne,splitProps as k,createSignal as h,createMemo as j,Show as x,createEffect as E,onCleanup as ae,For as O,Switch as ie,Match as I,Suspense as fe,ErrorBoundary as me}from"solid-js";import{a3 as le,m as F,P as q,q as K,n as pe,o as H,a4 as ve,l as he,a5 as be,a6 as ye,c as xe,a7 as Se,a8 as we,a9 as Ce,aa as X,ab as L,C as G,E as Ie,A as $e,N as _e,V as M,Q as Ne,ac as J,_ as Re,ad as Ee}from"./Toast.mjs";import{L as Y,u as Te}from"./Link.mjs";import{d as Fe}from"./index5.mjs";import{Transition as se}from"solid-headless";import{F as Z}from"./Field.mjs";import{createInfiniteQuery as De}from"@tanstack/solid-query";import{u as Oe}from"./useIntersectionObserver.mjs";import{E as ke}from"./EmptyState.mjs";import{P as Ae}from"./PlaylistCard.mjs";import Pe from"numeral";import{C as Be,S as Le}from"./Description.mjs";import{f as Ge}from"./routing.mjs";import{A as qe}from"./components.mjs";import"y-webrtc";import"yjs";import"solid-js/store";import"lib0/observable";import"@solid-primitives/date";import"./index4.mjs";import"./index2.mjs";const oe=te();function ce(){const e=re(oe);if(e===void 0)throw new Error("[kobalte]: `useRadioGroupContext` must be used within a `RadioGroup` component");return e}const ue=te();function V(){const e=re(ue);if(e===void 0)throw new Error("[kobalte]: `useRadioGroupItemContext` must be used within a `RadioGroup.Item` component");return e}function Ve(e){const r=le(),g=ce(),l=`${r.generateId("item")}-${ne()}`;e=F({id:l},e);const[c,n]=k(e,["value","disabled","onPointerDown"]),[u,a]=h(),[s,v]=h(),[d,S]=h(),[b,y]=h(),[R,$]=h(!1),_=j(()=>g.isSelectedValue(c.value)),w=j(()=>c.disabled||r.isDisabled()||!1),C=N=>{K(N,c.onPointerDown),R()&&N.preventDefault()},A=j(()=>({...r.dataset(),"data-disabled":w()?"":void 0,"data-checked":_()?"":void 0})),P={value:()=>c.value,dataset:A,isSelected:_,isDisabled:w,inputId:u,labelId:s,descriptionId:d,inputRef:b,select:()=>g.setSelectedValue(c.value),generateId:pe(()=>n.id),registerInput:H(a),registerLabel:H(v),registerDescription:H(S),setIsFocused:$,setInputRef:y};return t(ue.Provider,{value:P,get children(){return t(q,T({as:"div",role:"group",onPointerDown:C},A,n))}})}function Ue(e){const r=V();e=F({id:r.generateId("control")},e);const[g,l]=k(e,["onClick","onKeyDown"]);return t(q,T({as:"div",onClick:u=>{K(u,g.onClick),r.select(),r.inputRef()?.focus()},onKeyDown:u=>{K(u,g.onKeyDown),u.key===ve.Space&&(r.select(),r.inputRef()?.focus())}},()=>r.dataset(),l))}function je(e){const r=V();e=F({id:r.generateId("indicator")},e);const[g,l]=k(e,["ref","forceMount"]),c=he(()=>g.forceMount||r.isSelected());return t(x,{get when(){return c.isPresent()},get children(){return t(q,T({as:"div"},()=>r.dataset(),l))}})}function He(e){const r=le(),g=ce(),l=V();e=F({id:l.generateId("input")},e);const[c,n]=k(e,["ref","style","aria-labelledby","aria-describedby","onChange","onFocus","onBlur"]),u=()=>[c["aria-labelledby"],l.labelId(),c["aria-labelledby"]!=null&&n["aria-label"]!=null?n.id:void 0].filter(Boolean).join(" ")||void 0,a=()=>[c["aria-describedby"],l.descriptionId(),g.ariaDescribedBy()].filter(Boolean).join(" ")||void 0;return E(()=>ae(l.registerInput(n.id))),ee("input",T({type:"radio",get name(){return r.name()},get value(){return l.value()},get checked(){return l.isSelected()},get required(){return r.isRequired()},get disabled(){return l.isDisabled()},get readonly(){return r.isReadOnly()},get style(){return{...be,...c.style}},get"aria-labelledby"(){return u()},get"aria-describedby"(){return a()}},()=>l.dataset(),n),void 0,!0)}function Me(e){const r=V();return e=F({id:r.generateId("label")},e),E(()=>ae(r.registerLabel(e.id))),ee("label",T({get for(){return r.inputId()}},()=>r.dataset(),e),void 0,!0)}function Je(e){let r;const g=`radiogroup-${ne()}`;e=F({id:g,orientation:"vertical"},e);const[l,c,n]=k(e,["ref","value","defaultValue","onChange","orientation","aria-labelledby","aria-describedby"],ye),[u,a]=xe({value:()=>l.value,defaultValue:()=>l.defaultValue,onChange:y=>l.onChange?.(y)}),{formControlContext:s}=Se(c);we(()=>r,()=>a(l.defaultValue??""));const v=()=>s.getAriaLabelledBy(X(c.id),n["aria-label"],l["aria-labelledby"]),d=()=>s.getAriaDescribedBy(l["aria-describedby"]),b={ariaDescribedBy:d,isSelectedValue:y=>y===u(),setSelectedValue:y=>{s.isReadOnly()||s.isDisabled()||a(y)}};return t(Ce.Provider,{value:s,get children(){return t(oe.Provider,{value:b,get children(){return t(q,T({as:"div",role:"radiogroup",get id(){return X(c.id)},get"aria-invalid"(){return s.validationState()==="invalid"||void 0},get"aria-required"(){return s.isRequired()||void 0},get"aria-disabled"(){return s.isDisabled()||void 0},get"aria-readonly"(){return s.isReadOnly()||void 0},get"aria-orientation"(){return l.orientation},get"aria-labelledby"(){return v()},get"aria-describedby"(){return d()}},()=>s.dataset(),n))}})}})}var Ke=["<div",' class="flex items-center gap-2">',"</div>"],Qe=["<span",' class="bg-accent1 text-text3 rounded px-2 ">',"</span>"],We=["<span",' class="bg-primary text-text3 rounded px-2 ">',"</span>"],ze=["<button",">","</button>"],Xe=["<div",' class="flex gap-2 items-center mb-2 flex-wrap"><div class="flex items-center gap-1"><!--$-->','<!--/--><span class="font-bold">',"</span><!--$-->","<!--/--></div><!--$-->","<!--/--></div>"],Ye=["<input",' type="date" class="bg-accent1 text-text3 rounded px-2"',">"],Ze=["<div",' class="flex gap-2 items-center flex-wrap"><input type="date" class="bg-accent1 text-text3 rounded px-2"','><span class="font-bold">AND</span><input type="date" class="bg-accent1 text-text3 rounded px-2"',"></div>"],et=["<div",' class="flex gap-2 items-center flex-wrap"><!--$-->',"<!--/--><!--$-->","<!--/--><!--$-->","<!--/--><!--$-->","<!--/--></div>"],tt=["<div",' class="h-full w-full "><!--$-->',"<!--/--><!--$-->","<!--/--></div>"];const rt=["description","duration","name","subscribers","thumbnail","type","url","verified","videos","views","uploaderVerified","uploaderUrl","uploaderName","uploaded","title","isShort","playlistType","shortDescription","uploadedDate"],nt=e=>t(Je,{get value(){return e.value},get onChange(){return e.onChange},class:"",get children(){return f(Ke,m(),i(t(O,{get each(){return e.options},children:r=>t(Ve,{value:r,class:"flex items-center gap-1 rounded  focus-within:ring-2 focus-within:ring-primary",get children(){return[t(He,{class:"flex items-center gap-1"}),t(Ue,{class:"flex items-center justify-center w-5 h-5 rounded-full  border border-text2 data-[checked]:border-primary data-[checked]:bg-white focus-visible:border-spacing-1 focus-visible:border-primary",get children(){return t(je,{class:"w-2.5 h-2.5 rounded-full bg-primary"})}}),t(Me,{class:"",children:r})]}})})))}}),at=e=>f(Qe,m(),i(String(e.field))),it=e=>f(We,m(),i(e.value)),lt=e=>f(ze,m(),i(t(Fe,{fill:"currentColor",class:"w-3 h-3"}))),st=e=>{const[r,g]=h(!1);return[f(Xe,m(),i(t(at,{get field(){return e.field}})),i(e.operatorText),i(t(it,{get value(){return e.value}})),i(t(lt,{onClick:()=>e.removeCondition()}))),t(nt,{get value(){return e.selectedOperator},onChange:l=>{g(!0),e.selectOperator(l)},options:["AND","OR"]}),t(se,{enter:"transition duration-300 ease-in-out transform",enterFrom:"opacity-0 translate-y-2",enterTo:"opacity-100 translate-y-0",leave:"transition duration-300 ease-in-out transform",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-2",class:"my-2",get show(){return r()},get children(){return t(de,{addCondition:l=>{g(!1),e.addCondition(l)}})}})]},de=e=>{const[r,g]=h(""),[l,c]=h({value:"title",label:"title",disabled:!1}),[n,u]=h({value:"INCLUDES",label:"INCLUDES",disabled:!1});return f(et,m(),i(t(L,{get value(){return l()},get options(){return rt.map(a=>({value:a,label:a,disabled:!1}))},onChange:a=>{c(a)}})),i(t(L,{get value(){return n()},onChange:a=>u(a),get options(){return["INCLUDES","NOT_INCLUDES","LESS_THAN","GREATER_THAN","IS","IS_NOT","IS_BEFORE","IS_AFTER","IS_BETWEEN"].map(a=>({value:a,label:a,disabled:!1}))}})),i(t(ie,{get children(){return[t(I,{get when(){return n().value==="IS_BEFORE"||n().value==="IS_AFTER"},get children(){return f(Ye,m(),B("value",i(r(),!0),!1))}}),t(I,{get when(){return n().value==="IS_BETWEEN"},get children(){return[(g(JSON.stringify({start:new Date("1970-01-01").toISOString(),end:new Date().toISOString()})),[]),f(Ze,m(),B("value",i(JSON.parse(r()).start,!0),!1),B("value",i(JSON.parse(r()).end,!0),!1))]}}),t(I,{get when(){return n().value==="INCLUDES"||n().value==="NOT_INCLUDES"},get children(){return t(Z,{placeholder:"String or Regex",type:"text",get value(){return r()},get validationState(){return Number.isNaN(parseInt(r()))?"invalid":"valid"},onInput:a=>g(a)})}}),t(I,{get when(){return n().value==="LESS_THAN"||n().value==="GREATER_THAN"},get children(){return t(Z,{type:"number",get value(){return r()},get validationState(){return Number.isNaN(parseInt(r()))?"invalid":"valid"},onInput:a=>g(a)})}}),t(I,{get when(){return n().value==="IS"||n().value==="IS_NOT"},get children(){return t(L,{get value(){return{value:r(),label:r(),disabled:!1}},options:[{value:"true",label:"true",disabled:!1},{value:"false",label:"false",disabled:!1}],onChange:a=>g(a.value)})}})]}})),i(t(G,{label:"Add Condition",appearance:"danger",onClick:()=>{e.addCondition({type:n().value,field:l().value,value:r()})}})))},ot=e=>{const r=(a,s)=>{const[v,d]=h(!1);let S;return E(()=>{clearTimeout(S),S=setTimeout(()=>{d(!0)},100)}),t(se,{enter:"transition-all duration-300 ease-in-out transform",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-all duration-300 ease-in-out transform",leaveFrom:"opacity-100 ",leaveTo:"opacity-0 ",class:"my-2",get show(){return v()},get children(){return t(st,{get operatorText(){return a.type},get field(){return a.field},get value(){return a.value},addCondition:g,addOperator:c,removeCondition:()=>{l(s),u(s)},get selectedOperator(){return e.filter.operators[s]},selectOperator:b=>{e.filter.operators[s]?n(s,b):c(b)}})}})},g=a=>{e.setFilter(s=>({conditions:[...s.conditions,a],operators:s.operators}))},l=a=>{const s=[...e.filter.conditions];s.splice(a,1),e.setFilter(v=>({...v,conditions:s}))},c=a=>{e.setFilter(s=>({conditions:s.conditions,operators:[...s.operators,a]}))},n=(a,s)=>{const v=[...e.filter.operators];v[a]=s,e.setFilter(d=>({...d,operators:v}))},u=a=>{const s=[...e.filter.operators];s.splice(a,1),e.setFilter(v=>({...v,operators:s}))};return f(tt,m(),i(t(x,{get when(){return e.filter.conditions.length===0},get children(){return t(de,{addCondition:g})}})),i(t(O,{get each(){return e.filter.conditions},children:(a,s)=>r(a,s())})))},ct=(e,r,g=console.error)=>{if(e.conditions.length===0)return!0;let l=[];try{for(let n of e.conditions){let u=!1;switch(n.type){case"INCLUDES":u=new RegExp(n.value).test(r[n.field]?.toString().toLowerCase().trim());break;case"NOT_INCLUDES":u=!new RegExp(n.value).test(r[n.field]?.toString().toLowerCase().trim());break;case"LESS_THAN":const a=parseInt(n.value),s=parseInt(r[n.field]?.toString());u=isNaN(a)||isNaN(s)?!1:s<a;break;case"GREATER_THAN":const v=parseInt(n.value),d=parseInt(r[n.field]?.toString());u=isNaN(v)||isNaN(d)?!1:d>v;break;case"IS":u=new RegExp(n.value).test(r[n.field]?.toString());break;case"IS_NOT":u=!new RegExp(n.value).test(r[n.field]?.toString());case"IS_BEFORE":const S=new Date(n.value),b=new Date(r[n.field]?.toString());u=isNaN(S.getTime())||isNaN(b.getTime())?!1:b.getTime()<S.getTime();break;case"IS_AFTER":const y=new Date(n.value),R=new Date(r[n.field]?.toString());u=isNaN(y.getTime())||isNaN(R.getTime())?!1:R.getTime()>y.getTime();break;case"IS_BETWEEN":let $=null,_=null;try{let C=JSON.parse(n.value);C.start&&($=new Date(C.start)),C.end&&(_=new Date(C.end))}catch(C){g(C),u=!1;break}if(!$||!_){u=!1;break}const w=new Date(r[n.field]?.toString());u=isNaN(w.getTime())?!1:w.getTime()>=$.getTime()&&w.getTime()<=_.getTime();break}l.push(u)}let c=l[0];for(let n=0;n<e.operators.length;n++){let u=e.operators[n],a=l[n+1];if(u==="AND"){if(a===void 0)break;c=c&&a}else u==="OR"&&(c=c||a)}return c}catch(c){return g(c),!1}},ut=ot;var dt=["<div",' class="relative w-20 overflow-hidden rounded-full group-hover:ring-2 group-focus-visible:ring-2 ring-accent1 transition-all duration-200"><img class="w-full rounded-full group-hover:scale-105 group-focus-visible:scale-105"',' loading="lazy"></div>'],gt=["<div",' class="flex gap-1"><span>',"</span><!--$-->","<!--/--></div>"],ft=["<p",">&#183; <!--$-->","<!--/--> videos</p>"],mt=["<p",' class="two-line-ellipsis ">',"</p>"],pt=["<p","><!--$-->","<!--/--> subscribers</p>"],vt=["<div",' class="mx-4 my-2 flex flex-col gap-2 items-start w-full lg:w-72 max-h-20 lg:max-h-full max-w-md"><div class="flex items-center gap-2 w-full lg:flex-col lg:items-start"><!--$-->','<!--/--><div class="flex flex-col justify-center gap-1 min-w-0 w-full h-20 max-h-20 text-text2 text-xs self-end"><div class="flex items-center gap-1"><!--$-->',"<!--/--><!--$-->","<!--/--></div><!--$-->","<!--/--><!--$-->","<!--/--></div><!--$-->","<!--/--></div></div>"],ht=["<p","></p>"];function bt(e){return f(vt,m(),i(t(Y,{get href(){return e.item.url},class:"group outline-none",get children(){return f(dt,m(),B("src",i(e.item.thumbnail,!0),!1))}})),i(t(Y,{class:"link text-sm",get href(){return e.item.url},get children(){return f(gt,m(),i(e.item.name),i(t(x,{get when(){return e.item.verified},get children(){return t(Be,{})}})))}})),i(t(x,{get when(){return e.item.videos>=0},get children(){return f(ft,m(),i(e.item.videos))}})),i(t(x,{get when(){return e.item.description},get children(){return f(mt,m(),i(e.item.description))}})),i(t(x,{get when(){return e.item.subscribers>=0},get fallback(){return f(ht,m())},get children(){return f(pt,m(),i(Pe(e.item.subscribers).format("0a").toUpperCase()))}})),i(t(Le,{get id(){return e.item.url.split("/").pop()},get name(){return e.item.name}})))}var yt=["<div",' class="flex items-center justify-between my-2"><!--$-->',"<!--/--><button>Advanced Filters</button></div>"],xt=["<div",' class="bg-red-300 p-2 rounded-md text-red-900 flex justify-between items-center"><span>',"</span><span>x<!--$-->","<!--/--></span> </div>"],St=["<div",' class="flex flex-col justify-center items-center gap-4 h-full min-w-[20rem] min-h-[10rem]"><!--$-->','<!--/--><div class="flex flex-col gap-2"><div class="flex gap-2"><!--$-->',"<!--/--><!--$-->","<!--/--></div><!--$-->","<!--/--></div></div>"],wt=["<div",' class="mt-2"><p class="">Did you mean <!--$-->',"<!--/-->?</p></div>"],Ct=["<div",' class="flex flex-col items-center justify-center w-full h-full">',"</div>"],It=["<div",' class="w-full flex justify-center">',"</div>"],$t=["<div",' class="flex flex-wrap justify-center min-h-screen h-full items-start"><!--$-->',"<!--/--><!--$-->","<!--/--><!--$-->",'<!--/--><div class="w-full h-20 mt-2"></div></div>'],_t=["<div",' class="flex flex-wrap py-12 items-center justify-center w-full h-full">',"</div>"],Nt=["<div",`>Something went wrong 
<!--$-->`,"<!--/--><button>Retry</button></div>"];function zt(){const e=["all","videos","channels","playlists","music_songs","music_videos","music_albums","music_playlists"],[r,g]=Ge(),[l,c]=h(r.filter??"all"),n=Ie(),[u,a]=Te(),[s]=$e(),v=async({pageParam:o="initial"})=>o==="initial"?await(await fetch(`${s.instance.api_url}/search?q=${r.search_query}&filter=${l()}`)).json():await Ee(`${s.instance.api_url}/nextpage/search`,{nextpage:o,q:r.search_query,filter:l()}),d=De(()=>({queryKey:["search",r.search_query,l()],queryFn:v,enabled:!!(s.instance?.api_url&&r.search_query&&l()&&!z),getNextPageParam:o=>o.nextpage,refetchOnMount:!1,refetchOnReconnect:!1,initialPageParam:"initial",initialData:()=>{}}));E(()=>{document.title=r.search_query+" - Conduit",R()}),E(()=>{console.log("app state loading",d.isLoading,d.isFetching),a({loading:d.isLoading||d.isFetching||d.isRefetching})});const S=Oe({setTarget:()=>w()});let b;E(()=>{if(console.log(S(),w(),"intersecting"),S()){d.fetchNextPage();return}!d.isFetching||!d.hasNextPage||(clearInterval(b),b=setInterval(()=>{const o=$().getBoundingClientRect().bottom;w().getBoundingClientRect().bottom<o&&(d.fetchNextPage(),console.log("fetching next page"))},1e3))});function y(o){c(o),g({filter:o})}function R(){const o=r.search_query;if(!o)return;const p=_e("search_history",[],"json","localStorage");if(p.includes(o)){const D=p.indexOf(o);p.splice(D,1)}p.unshift(o),p.length>10&&p.shift(),localStorage.setItem("search_history",JSON.stringify(p))}const[$,_]=h(void 0),[w,C]=h(void 0),[A,P]=h(!1),[N,Q]=h([]),[U,W]=h((!z&&JSON.parse(localStorage.getItem("search_filter")??"null"))??{conditions:[],operators:[]});return t(fe,{get fallback(){return f(_t,m(),i(t(O,{get each(){return Array(40).fill(0)},children:()=>t(M,{v:void 0})})))},get children(){return[f(yt,m(),i(t(L,{get options(){return e.map(o=>({value:o,label:o.replace(/_/g," ").replace(/\b\w/g,p=>p.toUpperCase())}))},get value(){return{value:l(),label:l().replace(/_/g," ").replace(/\b\w/g,o=>o.toUpperCase()),disabled:!1}},onChange:o=>y(o.value)}))),t(x,{get when(){return N().length>0},get children(){return f(xt,m(),i(N()[N().length-1]),i(N().length))}}),t(me,{fallback:(o,p)=>f(Nt,m(),i(o.message)),get children(){return t(Ne,{get isOpen(){return A()},setIsOpen:P,title:"Advanced Filters",get children(){return f(St,m(),i(t(ut,{get filter(){return U()},setFilter:W})),i(t(G,{appearance:"link",label:"Save Filter",onClick:()=>{localStorage.setItem("search_filter",JSON.stringify(U()))}})),i(t(G,{appearance:"subtle",label:"Clear Filter",onClick:()=>{Q([]),W({conditions:[],operators:[]})}})),i(t(G,{label:"Done",onClick:()=>{P(!1)}})))}})}}),t(x,{get when(){return d.data?.pages?.[0].corrected},get children(){return f(wt,m(),i(t(qe,{get href(){return`/results?search_query=${d.data?.pages[0].suggestion}&filter=${l()}`},class:"link !text-accent1",get children(){return d.data?.pages[0].suggestion}})))}}),f($t,m(),i(t(x,{get when(){return d.data?.pages?.[0]?.items.length===0},get children(){return f(Ct,m(),i(t(ke,{})))}})),i(t(x,{get when(){return d.data?.pages?.[0]?.items&&d.data.pages[0].items.length>0},get fallback(){return t(O,{get each(){return Array(40).fill(0)},children:()=>t(M,{v:void 0})})},get children(){return t(O,{get each(){return d.data.pages?.map(o=>o.items).flat().filter((o,p,D)=>D.findIndex(ge=>ge?.url===o?.url)===p).filter(o=>!n.store.blocklist[o.uploaderUrl?.split("/").pop()])},children:o=>t(x,{get when(){return ct(U(),o,p=>Q(D=>[...D,p.message]))},get children(){return t(ie,{get children(){return[t(I,{get when(){return J(o,"type","stream")},keyed:!0,children:p=>t(M,{v:p})}),t(I,{get when(){return J(o,"type","channel")},keyed:!0,children:p=>t(bt,{item:p})}),t(I,{get when(){return J(o,"type","playlist")},keyed:!0,children:p=>t(Ae,{item:p})})]}})}})})}})),i(t(x,{get when(){return u.loading},get children(){return f(It,m(),i(t(Re,{})))}})))]}})}export{zt as default};
//# sourceMappingURL=results.mjs.map
