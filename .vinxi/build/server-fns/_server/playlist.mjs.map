{"version":3,"file":"playlist.mjs","sources":["../../../../src/routes/playlist.tsx?pick=default&pick=$css"],"sourcesContent":["import numeral from \"numeral\";\nimport { createRenderEffect, For } from \"solid-js\";\nimport {\n  createEffect,\n  createSignal,\n  onMount,\n  Show,\n  useContext,\n} from \"solid-js\";\nimport { Playlist as PlaylistType, RelatedStream } from \"~/types\";\nimport { fetchJson } from \"~/utils/helpers\";\nimport { useSyncStore } from \"~/stores/syncStore\";\nimport { createQuery } from \"@tanstack/solid-query\";\nimport { usePreferences } from \"~/stores/preferencesStore\";\nimport PlaylistItem from \"~/components/content/playlist/PlaylistItem\";\nimport { useLocation } from \"@solidjs/router\";\nimport { Title } from \"@solidjs/meta\";\n\nexport default function Playlist() {\n  const [list, setList] = createSignal<PlaylistType>();\n  const route = useLocation();\n  const isLocal = () => route.query.list?.startsWith(\"conduit-\");\n  const id = route.query.list;\n  const sync = useSyncStore();\n  const [preferences] = usePreferences();\n\n  createEffect(async () => {\n    if (!id) return;\n    if (!isLocal()) return;\n    await new Promise((r) => setTimeout(r, 100));\n    const l = sync.store.playlists[id];\n    setList(l);\n  });\n  const query = createQuery(() => ({\n    queryKey: [\"playlist\"],\n    queryFn: async (): Promise<PlaylistType> =>\n      (await fetch(preferences.instance.api_url + \"/playlists/\" + id)).json(),\n    enabled: preferences.instance.api_url && !isLocal() && id ? true : false,\n  }));\n\n  createEffect(() => {\n    if (!query.data) return;\n    setList(query.data);\n  });\n\n  return (\n    <>\n      <Title>{list() ? list()!.name : \"Playlist\"}</Title>\n      <Show when={list()} keyed>\n        {(l) => {\n          return (\n            <div class=\"max-w-5xl mx-auto\">\n              <h1 class=\"text-2xl font-bold mb-4\">{list()!.name}</h1>\n\n              <div class=\"grid grid-cols-1 gap-4 \">\n                <Show when={l.relatedStreams.length > 0}>\n                  <For\n                    each={l.relatedStreams\n                      // blocklist\n                      .filter(\n                        (item) =>\n                          !sync.store.blocklist[\n                            item?.uploaderUrl?.split(\"/\").pop()!\n                          ]\n                      )}\n                  >\n                    {(video, index) => (\n                      <PlaylistItem\n                        active=\"\"\n                        v={video}\n                        index={index() + 1}\n                        list={id}\n                      />\n                    )}\n                  </For>\n                </Show>\n              </div>\n            </div>\n          );\n        }}\n      </Show>\n    </>\n  );\n}\n"],"names":["Playlist","list","setList","createSignal","route","useLocation","isLocal","query","startsWith","id","sync","useSyncStore","preferences","usePreferences","createEffect","Promise","r","setTimeout","l","store","playlists","createQuery","queryKey","queryFn","fetch","instance","api_url","json","enabled","data","_$createComponent","Title","children","name","Show","when","keyed","_$ssr","_tmpl$","_$ssrHydrationKey","_$escape","relatedStreams","length","For","each","filter","item","blocklist","uploaderUrl","split","pop","video","index","PlaylistItem","active","v"],"mappings":"8tBAkBA,SAAwBA,GAAW,CACjC,KAAM,CAACC,EAAMC,CAAO,EAAIC,EAA2B,EAC7CC,EAAQC,IACRC,EAAUA,IAAMF,EAAMG,MAAMN,MAAMO,WAAW,UAAU,EACvDC,EAAKL,EAAMG,MAAMN,KACjBS,EAAOC,IACP,CAACC,CAAW,EAAIC,IAEtBC,EAAa,SAAY,CAEvB,GADI,CAACL,GACD,CAACH,EAAQ,EAAG,OAChB,MAAM,IAAIS,QAASC,GAAMC,WAAWD,EAAG,GAAG,CAAC,EAC3C,MAAME,EAAIR,EAAKS,MAAMC,UAAUX,CAAE,EACjCP,EAAQgB,CAAC,CAAA,CACV,EACKX,MAAAA,EAAQc,EAAY,KAAO,CAC/BC,SAAU,CAAC,UAAU,EACrBC,QAAS,UACN,MAAMC,MAAMZ,EAAYa,SAASC,QAAU,cAAgBjB,CAAE,GAAGkB,KAAK,EACxEC,QAAShB,GAAAA,EAAYa,SAASC,SAAW,CAACpB,KAAaG,EACvD,EAAA,EAEFK,OAAAA,EAAa,IAAM,CACZP,EAAMsB,MACX3B,EAAQK,EAAMsB,IAAI,CAAA,CACnB,EAEDC,CAAAA,EAEKC,EAAK,CAAA,IAAAC,UAAA,CAAA,OAAE/B,EAAK,EAAIA,IAAQgC,KAAO,UAAU,CAAA,CAAAH,EAAAA,EACzCI,EAAI,CAAA,IAACC,MAAI,CAAA,OAAElC,EAAK,CAAC,EAAEmC,MAAK,GAAAJ,SACfd,GACNmB,EAAAC,EAAAC,EAAAA,EAAAC,EAEyCvC,EAAK,EAAGgC,IAAI,EAAAO,EAAAV,EAG9CI,EAAI,CAAA,IAACC,MAAI,CAAEjB,OAAAA,EAAEuB,eAAeC,OAAS,CAAC,EAAA,IAAAV,UAAA,CAAA,OAAAF,EACpCa,EAAG,CAAA,IACFC,MAAI,CAAA,OAAE1B,EAAEuB,eAELI,OACEC,GACC,CAACpC,EAAKS,MAAM4B,UACVD,GAAME,aAAaC,MAAM,GAAG,EAAEC,IAAM,CAAA,CAE1C,CAAC,EAAAlB,SAEFA,CAACmB,EAAOC,IAAKtB,EACXuB,EAAY,CACXC,OAAM,GACNC,EAAGJ,EAAK,IACRC,OAAK,CAAA,OAAEA,EAAU,EAAA,CAAC,EAClBnD,KAAMQ,CAAAA,CAAE,CAAA,CAEX,CAAA,CAAA,CAAA,CAAA,CAAA,CAMZ,CAAA,CAAA,CAIT"}