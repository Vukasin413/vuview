import{createComponent as r,ssr as m,ssrHydrationKey as f,escape as e,ssrAttribute as k}from"solid-js/web";import{createSignal as s,Show as L,createEffect as O,For as V,batch as z}from"solid-js";import{E as M,Q as H,C as p,V as q,aq as J,aB as K}from"./assets/syncStore-DaflpWzS.js";import{u as Q}from"./assets/useIntersectionObserver-sC3M1o1b.js";import"./assets/Link-ClDVT-6o.js";import G from"@leeoniya/ufuzzy";import{F as j}from"./assets/Field-D-TYCh3e.js";import{T as P}from"./assets/index-BIuKkAdd.js";import"y-webrtc";import"yjs";import"solid-js/store";import"lib0/observable";import"./assets/index-BPtxG8PX.js";import"./assets/index-wr7A5cEE.js";import"numeral";import"@solid-primitives/date";import"./assets/index-Bhsy5eyg.js";import"./assets/routing-CB9zsxEG.js";import"./assets/components-Bl9pqdE7.js";var W=["<strong",">","</strong>"],X=["<form",'><br><div><input type="file"></div><textarea class="text-black"></textarea><br><div>',"</div> <div><progress","></progress><div>",'</div></div><div><button class="btn w-auto">Import</button></div></form>'];function Y(a){const[b,o]=s([]),[E,I]=s(0),[w,S]=s(0),[$,x]=s(0),[h,T]=s(0),c=()=>b()?.length||0;return M(),r(H,{title:"Import History",get isOpen(){return a.isOpen},get setIsOpen(){return a.setIsOpen},get children(){return m(X,f(),e(r(L,{get when(){return c()>0},get children(){return m(W,f(),`Found ${e(c())} items`)}})),k("value",e(E(),!0),!1)+k("max",e(c(),!0),!1),`Success: ${e(w())} Error: ${e($())} Skipped: ${e(h())}`)}})}var Z=["<div",' class="flex flex-col items-center justify-center"><div class="text-sm text-text1">This operation cannot be undone.</div><div class="flex mt-4 flex-col gap-2 items-center"><!--$-->','<!--/--><div class="flex gap-2"><!--$-->',"<!--/--><!--$-->","<!--/--></div></div></div>"],tt=["<div",' class="w-full h-20 mt-2"></div>'],et=["<div",' class=""><!--$-->',"<!--/--><!--$-->","<!--/--><!--$-->","<!--/--><!--$-->","<!--/--><!--$-->","<!--/--><!--$-->","<!--/--><!--$-->",'<!--/--><div class="flex flex-wrap justify-center h-full min-h-[80vh]">',"</div></div>"];function $t(){const[a,b]=s(50);s([]);const o=M();function E(){z(()=>{Object.keys(o.store.history).forEach(t=>{o.setStore("history",t,void 0)})})}O(()=>{o.store.history&&console.log(Object.keys(o.store.history)?.length)});const[I,w]=s(void 0),S=Q({setTarget:()=>I()});O(()=>{S()&&b(t=>t+10)});const $=(t,l)=>{const u=d=>new Date(d).getTime();if(!t.watchedAt)return 1;if(!l.watchedAt)return-1;const i=u(t.watchedAt),n=u(l.watchedAt);return isNaN(i)?1:isNaN(n)?-1:i<=0?1:n<=0?-1:n-i},[x,h]=s([]),[T,c]=s(!1),[C,N]=s(""),R=K(t=>{N(t)},500),A=new G({intraMode:1,intraChars:"[w-]",intraSub:1,intraTrn:1,intraDel:1,intraIns:1});O(()=>{if(C()){const t=Object.values(o.store.history).map(g=>`${g.title} ${g.uploaderName}`),[l,u,i]=A.search(t,C(),!1),n=Object.values(o.store.history),d=l?.map(g=>n[g])?.slice(0,a())??[];h(d)}else{if(!o.store.history)return;h(Object.values(o.store.history).sort($).slice(0,a()))}});const F=()=>{const t=Object.values(o.store.history),l=JSON.stringify({platform:"Conduit",version:1,history:t},null,2),u=new Blob([l],{type:"application/json"}),i=URL.createObjectURL(u),n=document.createElement("a");n.href=i;const d=`conduit-history-${new Date().toISOString()}.json`;n.download=d,n.click(),URL.revokeObjectURL(i)},[_,v]=s(!1),[y,U]=s(""),[B,D]=s(!1);return s(!1),m(et,f(),e(r(P,{children:"History | Conduit"})),e(r(p,{label:"Import",onClick:()=>c(!0)})),e(r(Y,{get isOpen(){return T()},setIsOpen:t=>{console.log(t,"setIsOpen"),c(t)}})),e(r(p,{label:"Export",onClick:F})),e(r(p,{label:"Clear",onClick:()=>v(!0)})),e(r(H,{title:"Delete history?",get isOpen(){return _()},setIsOpen:v,get children(){return m(Z,f(),e(r(j,{class:"ml-2",get value(){return y()},onInput:t=>{D(!1),U(t)},type:"text",get errorMessage(){return y()!=="DELETE"&&B()?"Must type DELETE to confirm":""},placeholder:"DELETE",name:"Type DELETE to confirm",get validationState(){return y()!=="DELETE"?"invalid":"valid"}})),e(r(p,{label:"Cancel",onClick:()=>v(!1)})),e(r(p,{label:"Delete",class:"ml-2",onClick:()=>{D(!0),y()==="DELETE"&&(E(),v(!1))}})))}})),e(r(j,{onInput:t=>R(t),class:"my-2 mx-auto",placeholder:"Search..."})),e(r(L,{get when(){return x()},get children(){return[r(V,{get each(){return x()},children:t=>r(q,{get v(){return{...t,url:`/watch?v=${J(t)}`}}})}),m(tt,f())]}})))}export{$t as default};
//# sourceMappingURL=history.js.map
